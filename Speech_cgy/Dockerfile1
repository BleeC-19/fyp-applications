FROM ubuntu:18.04
RUN apt-get update --fix-missing
RUN apt-get install python3 -y
RUN apt-get install python3-pip -y
RUN apt-get install wget zip unzip -y

RUN pip3 install SpeechRecognition
RUN apt-get install -y swig libpulse-dev libasound2-dev
RUN apt-get install libsm6 libxrender1 libfontconfig1 libxext-dev -y

RUN pip3 install pocketsphinx

RUN pip3 install grpcio
RUN pip3 install protobuf

RUN apt-get install curl -y
RUN apt-get install ffmpeg -y

# for pydub in truncate.py
RUN pip3 install pydub
RUN apt-get install ffmpeg libavcodec-extra -y

# for listing files in truncate.py
RUN pip3 install glob3



# container/ will have predict.py, data/

ADD Speech_cgy/c1-Preprocess/app /container/
ADD Speech_cgy/c1-Preprocess/data /container/data


ADD grpc/app/container_entry.sh /container/
ADD grpc/app/server.py /container/
ADD grpc/app/model_pb2_grpc.py /container/
ADD grpc/app/model_pb2.py /container/
ADD grpc/app/proxy_pb2_grpc.py /container/
ADD grpc/app/proxy_pb2.py /container/

WORKDIR /container

# CMD ["python3", "/container/predict.py"]
CMD ["/container/container_entry.sh", "c1", "/container/server.py"]

EXPOSE 8000